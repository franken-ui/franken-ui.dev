---
import Master from "layouts/master/latest.astro";
import Snippet from "src/snippets_pages/component.astro";

const { metadata } = Astro.props;

const meta = {
  title: `Franken UI: Pages - ${metadata.title}`,
  url: `https://franken-ui.dev/pages/2.1/${metadata.category}/${metadata.id}`,
};
---

<Master
  doc={{
    title: meta.title,
  }}
>
  <div class="min-h-screen xl:mx-auto xl:max-w-[100rem]">
    <main>
      <div class="px-4 py-8 lg:px-8 lg:py-6">
        <div class="mb-6 flex justify-center">
          <a
            class="uk-btn uk-btn-default uk-btn-sm"
            href="/docs/2.1/installation"
          >
            <uk-icon class="mr-2 size-4" icon="arrow-left"></uk-icon>
            Back to Documentation
          </a>
        </div>
        <h1 class="uk-h1">{metadata.title}</h1>
        <p class="uk-text-lead uk-paragraph">{metadata.description}</p>

        <div class="mt-6 flex items-center justify-between">
          <div class="flex items-center gap-x-2">
            <ul
              class="uk-tab-alt max-w-40"
              data-uk-switcher="connect: #a"
              style="--uk-tab-alt-height: 2rem"
            >
              <li class="uk-active"><a href="#">Preview</a></li>
              <li><a href="#">Code</a></li>
            </ul>

            <button
              class="uk-btn uk-btn-primary uk-btn-sm"
              data-uk-toggle="#share"
            >
              <uk-icon class="mr-2 size-4" icon="share-2"></uk-icon>
              <span>Share</span>
            </button>
          </div>

          <div class="flex items-center gap-x-2">
            <div class="hidden h-9 md:block">
              <uk-resizer cls-custom="uk-btn-sm" selector="#preview"
              ></uk-resizer>
            </div>

            <button
              class="uk-btn uk-btn-default uk-btn-icon uk-btn-sm"
              data-uk-toggle="target: #theme"
            >
              <span class="size-4">
                <uk-icon icon="palette"></uk-icon>
              </span>
            </button>
          </div>
        </div>

        <ul id="a" class="uk-switcher mt-6">
          <li class="preview-container">
            <div id="preview" style="max-width: 100%; margin: 0px auto;">
              <iframe
                name={metadata.id}
                src={`${import.meta.env.PAGES_URL}/${metadata.category}/${metadata.id}`}
                width="100%"
                height={`${metadata.frame.height}px`}
                style="border: 0;outline: none;"></iframe>
            </div>
          </li>
          <li>
            <Snippet page={`${metadata.category}.${metadata.id}`} />
          </li>
        </ul>
      </div>
    </main>
  </div>

  <div class="uk-modal uk-flex-top" id="share" data-uk-modal>
    <div class="uk-modal-dialog uk-margin-auto-vertical">
      <div class="uk-modal-body">
        <h2 class="uk-modal-title">Share</h2>

        <div class="mt-5 flex gap-x-2">
          <input
            class="uk-input flex-1"
            type="text"
            readonly
            value={meta.url}
          />
          <button class="uk-btn uk-btn-default uk-btn-icon flex-none" id="copy">
            <uk-icon icon="copy"></uk-icon>
          </button>

          <script is:inline>
            const copyButton = document.getElementById("copy");

            const urlInput =
              copyButton.parentElement.querySelector('input[type="text"]');

            copyButton.addEventListener("click", async function () {
              try {
                urlInput.select();
                urlInput.setSelectionRange(0, 99999); // For mobile devices

                // Copy to clipboard using the modern Clipboard API
                await navigator.clipboard.writeText(urlInput.value);

                window.UIkit.notification({
                  message: "Copied to clipboard",
                  status: "primary",
                });
              } catch (err) {
                // Fallback for older browsers
                document.execCommand("copy");
              }
            });
          </script>
        </div>

        <ul class="mt-4 flex gap-x-1">
          <li>
            <a
              class="uk-btn uk-btn-default uk-btn-icon"
              href={`https://t.me/share/url?url=${encodeURI(meta.url)}&text=${encodeURI(meta.title)}`}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M15 10l-4 4l6 6l4 -16l-18 7l4 2l2 6l3 -4"></path>
              </svg>
            </a>
          </li>
          <li>
            <a
              class="uk-btn uk-btn-default uk-btn-icon"
              href={`https://api.whatsapp.com/send?text=${encodeURI(meta.title)}%20${encodeURI(meta.url)}`}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-brand-whatsapp"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M3 21l1.65 -3.8a9 9 0 1 1 3.4 2.9l-5.05 .9"></path>
                <path
                  d="M9 10a.5 .5 0 0 0 1 0v-1a.5 .5 0 0 0 -1 0v1a5 5 0 0 0 5 5h1a.5 .5 0 0 0 0 -1h-1a.5 .5 0 0 0 0 1"
                ></path>
              </svg>
            </a>
          </li>
          <li>
            <a
              class="uk-btn uk-btn-default uk-btn-icon"
              href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURI(meta.url)}`}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-brand-facebook"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path
                  d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"
                ></path>
              </svg>
            </a>
          </li>
          <li>
            <a
              class="uk-btn uk-btn-default uk-btn-icon"
              href={`https://twitter.com/intent/tweet?text=${encodeURI(meta.title)}&url=${encodeURI(meta.url)}&via=frankendashui`}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="icon icon-tabler icons-tabler-outline icon-tabler-brand-x"
              >
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M4 4l11.733 16h4.267l-11.733 -16z"></path>
                <path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772"></path>
              </svg>
            </a>
          </li>
        </ul>

        <div class="mt-4">
          <button class="uk-modal-close uk-btn uk-btn-secondary">
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <script is:inline define:vars={{ id: metadata.id }}>
    const iframe = window.frames[id];

    const observer = new MutationObserver(() => {
      iframe.postMessage(
        {
          className: htmlElement.className,
          classList: Array.from(htmlElement.classList),
          ls: localStorage.getItem("__FRANKEN__"),
        },
        "*",
      );
    });

    observer.observe(htmlElement, {
      attributes: true,
      attributeFilter: ["class"],
    });
  </script>
</Master>
